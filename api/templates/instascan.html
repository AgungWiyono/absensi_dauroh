{% extends 'base.html' %}

{% block header %}
	<script type="text/javascript" src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
{% endblock %}

{% block content -%}

<div class="container">
	<div class="row">
		<div class="col-sm-9 col-md-7 col-lg-5 mx-auto">
			<video id="preview"></video>
		</div>
	</div>
</div>


<script type="text/javascript">
    var scanner = new Instascan.Scanner({ video: document.getElementById('preview'), scanPeriod: 5, mirror: false });
    scanner.addListener('scan',function(content){
			let dataArray = content.split('|')
			let postedData = {name:dataArray[0], member_id:dataArray[1], email:dataArray[2]}
			console.log(postedData)

			$.ajax({
				url:'/api/test',
				type:'POST',
				data: JSON.stringify(postedData),
				dataType:'json',
				contentType:'application/json',
				success:function(data, status){
					alert(data.msg)
					console.log(data)
				},
				error: function(xhr, status, error){
					alert(xhr.responseJSON.msg)
					console.log(xhr)
				}
			})
    });
    Instascan.Camera.getCameras().then(function (cameras){
        if(cameras.length>0){
            scanner.start(cameras[0]);
        }else{
            console.error('No cameras found.');
            alert('No cameras found.');
        }
    }).catch(function(e){
        console.error(e);
        alert(e);
    });
</script>

{% endblock %}
